# 自适应布局

使用 `postcss-pxtorem` 进行px转rem，虽然可以转换css中的px值，但是会出现内联样式和动态值中无法进行转换的情况

```js
"postcss-pxtorem": "^6.0.0"
```

## 配置项

`postcss.config` 

> 按照 vant 官网所说的教程，将 rootValue 设置为37.5 或75，https://vant-ui.github.io/vant/#/zh-CN/advanced-usage#qi-ta-she-ji-gao-chi-cun
>
> 但是无法和设计图进行对齐

```js
const autoprefixer = require('autoprefixer')
const pxtorem = require('postcss-pxtorem')

module.exports = {
  plugins: [
    autoprefixer(),
    pxtorem({
      rootValue: 0.75,
      unitPrecision: 5,
      propList: ['*'],
      selectorBlackList: ['.ignore', 'keep-px'],
      minPixelValue: 1,
      mediaQuery: false,
      exclude: (path) => {
        // 忽略 node_modules/element-plus 目录下的所有文件
        return path.includes('node_modules/element-plus')
      },
    }),
  ],
}

```

重新 [lib-flexible](https://github.com/amfe/lib-flexible) 函数，新建一个工具类 resizeHandler.ts

```ts
/**
 * 监听窗口变化
 * @param elementId
 * @param uiWidth 2倍图尺寸计算
 */
export default function resizeHandler(elementId: string, uiWidth = 750) {
  let clientWidth = 0
  try {
    const dpr = window.devicePixelRatio || 1
    console.log('dpr', dpr)

    if (dpr > 1) {
      const dom = document.getElementById(elementId) as Element
      if (dom) {
        clientWidth = dom.clientWidth
        // 设置html标签的fontSize
        document.documentElement.style.fontSize = clientWidth / uiWidth + 'px'
      }
    } else {
      document.documentElement.style.fontSize = '0.75px'
    }
  } catch (e) {
    console.log(e)
  }
}
```

引用

```ts
import resizeHandler from '@/utils/resizeHandler'

export function useResizeHandler() {
  const resizeObserver = ref<ResizeObserver>()

  onMounted(() => {
    nextTick(() => {
      handleResizeObserver()
    })
  })

  onUnmounted(() => {
    resizeObserver.value?.unobserve(document.documentElement as Element)
    resizeObserver.value?.disconnect()
  })

  /**
   * 处理窗口变化
   */
  const handleResizeObserver = () => {
    resizeObserver.value = new ResizeObserver(() => {
      resizeHandler('app')
    })
    resizeObserver.value?.observe(document.documentElement as Element)
  }
}
```

